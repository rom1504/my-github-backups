{
    "_links": {
        "comments": {
            "href": "https://api.github.com/repos/mhsjlw/flying-squid/issues/94/comments"
        },
        "commits": {
            "href": "https://api.github.com/repos/mhsjlw/flying-squid/pulls/94/commits"
        },
        "html": {
            "href": "https://github.com/mhsjlw/flying-squid/pull/94"
        },
        "issue": {
            "href": "https://api.github.com/repos/mhsjlw/flying-squid/issues/94"
        },
        "review_comment": {
            "href": "https://api.github.com/repos/mhsjlw/flying-squid/pulls/comments{/number}"
        },
        "review_comments": {
            "href": "https://api.github.com/repos/mhsjlw/flying-squid/pulls/94/comments"
        },
        "self": {
            "href": "https://api.github.com/repos/mhsjlw/flying-squid/pulls/94"
        },
        "statuses": {
            "href": "https://api.github.com/repos/mhsjlw/flying-squid/statuses/738ac51ce25cf895c70dea5e59103de0b2de3a46"
        }
    },
    "assignee": null,
    "base": {
        "label": "mhsjlw:master",
        "ref": "master",
        "repo": {
            "archive_url": "https://api.github.com/repos/mhsjlw/flying-squid/{archive_format}{/ref}",
            "assignees_url": "https://api.github.com/repos/mhsjlw/flying-squid/assignees{/user}",
            "blobs_url": "https://api.github.com/repos/mhsjlw/flying-squid/git/blobs{/sha}",
            "branches_url": "https://api.github.com/repos/mhsjlw/flying-squid/branches{/branch}",
            "clone_url": "https://github.com/mhsjlw/flying-squid.git",
            "collaborators_url": "https://api.github.com/repos/mhsjlw/flying-squid/collaborators{/collaborator}",
            "comments_url": "https://api.github.com/repos/mhsjlw/flying-squid/comments{/number}",
            "commits_url": "https://api.github.com/repos/mhsjlw/flying-squid/commits{/sha}",
            "compare_url": "https://api.github.com/repos/mhsjlw/flying-squid/compare/{base}...{head}",
            "contents_url": "https://api.github.com/repos/mhsjlw/flying-squid/contents/{+path}",
            "contributors_url": "https://api.github.com/repos/mhsjlw/flying-squid/contributors",
            "created_at": "2015-08-25T23:30:19Z",
            "default_branch": "master",
            "description": "A minecraft server written in node.js, modularized",
            "downloads_url": "https://api.github.com/repos/mhsjlw/flying-squid/downloads",
            "events_url": "https://api.github.com/repos/mhsjlw/flying-squid/events",
            "fork": false,
            "forks": 13,
            "forks_count": 13,
            "forks_url": "https://api.github.com/repos/mhsjlw/flying-squid/forks",
            "full_name": "mhsjlw/flying-squid",
            "git_commits_url": "https://api.github.com/repos/mhsjlw/flying-squid/git/commits{/sha}",
            "git_refs_url": "https://api.github.com/repos/mhsjlw/flying-squid/git/refs{/sha}",
            "git_tags_url": "https://api.github.com/repos/mhsjlw/flying-squid/git/tags{/sha}",
            "git_url": "git://github.com/mhsjlw/flying-squid.git",
            "has_downloads": true,
            "has_issues": true,
            "has_pages": false,
            "has_wiki": true,
            "homepage": "",
            "hooks_url": "https://api.github.com/repos/mhsjlw/flying-squid/hooks",
            "html_url": "https://github.com/mhsjlw/flying-squid",
            "id": 41393164,
            "issue_comment_url": "https://api.github.com/repos/mhsjlw/flying-squid/issues/comments{/number}",
            "issue_events_url": "https://api.github.com/repos/mhsjlw/flying-squid/issues/events{/number}",
            "issues_url": "https://api.github.com/repos/mhsjlw/flying-squid/issues{/number}",
            "keys_url": "https://api.github.com/repos/mhsjlw/flying-squid/keys{/key_id}",
            "labels_url": "https://api.github.com/repos/mhsjlw/flying-squid/labels{/name}",
            "language": "JavaScript",
            "languages_url": "https://api.github.com/repos/mhsjlw/flying-squid/languages",
            "merges_url": "https://api.github.com/repos/mhsjlw/flying-squid/merges",
            "milestones_url": "https://api.github.com/repos/mhsjlw/flying-squid/milestones{/number}",
            "mirror_url": null,
            "name": "flying-squid",
            "notifications_url": "https://api.github.com/repos/mhsjlw/flying-squid/notifications{?since,all,participating}",
            "open_issues": 43,
            "open_issues_count": 43,
            "owner": {
                "avatar_url": "https://avatars.githubusercontent.com/u/8526903?v=3",
                "events_url": "https://api.github.com/users/mhsjlw/events{/privacy}",
                "followers_url": "https://api.github.com/users/mhsjlw/followers",
                "following_url": "https://api.github.com/users/mhsjlw/following{/other_user}",
                "gists_url": "https://api.github.com/users/mhsjlw/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/mhsjlw",
                "id": 8526903,
                "login": "mhsjlw",
                "organizations_url": "https://api.github.com/users/mhsjlw/orgs",
                "received_events_url": "https://api.github.com/users/mhsjlw/received_events",
                "repos_url": "https://api.github.com/users/mhsjlw/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/mhsjlw/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/mhsjlw/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/mhsjlw"
            },
            "private": false,
            "pulls_url": "https://api.github.com/repos/mhsjlw/flying-squid/pulls{/number}",
            "pushed_at": "2015-12-14T23:20:22Z",
            "releases_url": "https://api.github.com/repos/mhsjlw/flying-squid/releases{/id}",
            "size": 569,
            "ssh_url": "git@github.com:mhsjlw/flying-squid.git",
            "stargazers_count": 29,
            "stargazers_url": "https://api.github.com/repos/mhsjlw/flying-squid/stargazers",
            "statuses_url": "https://api.github.com/repos/mhsjlw/flying-squid/statuses/{sha}",
            "subscribers_url": "https://api.github.com/repos/mhsjlw/flying-squid/subscribers",
            "subscription_url": "https://api.github.com/repos/mhsjlw/flying-squid/subscription",
            "svn_url": "https://github.com/mhsjlw/flying-squid",
            "tags_url": "https://api.github.com/repos/mhsjlw/flying-squid/tags",
            "teams_url": "https://api.github.com/repos/mhsjlw/flying-squid/teams",
            "trees_url": "https://api.github.com/repos/mhsjlw/flying-squid/git/trees{/sha}",
            "updated_at": "2015-12-14T23:20:38Z",
            "url": "https://api.github.com/repos/mhsjlw/flying-squid",
            "watchers": 29,
            "watchers_count": 29
        },
        "sha": "47b6e00d5ed9625edf630503bc2261a91036f600",
        "user": {
            "avatar_url": "https://avatars.githubusercontent.com/u/8526903?v=3",
            "events_url": "https://api.github.com/users/mhsjlw/events{/privacy}",
            "followers_url": "https://api.github.com/users/mhsjlw/followers",
            "following_url": "https://api.github.com/users/mhsjlw/following{/other_user}",
            "gists_url": "https://api.github.com/users/mhsjlw/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/mhsjlw",
            "id": 8526903,
            "login": "mhsjlw",
            "organizations_url": "https://api.github.com/users/mhsjlw/orgs",
            "received_events_url": "https://api.github.com/users/mhsjlw/received_events",
            "repos_url": "https://api.github.com/users/mhsjlw/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/mhsjlw/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/mhsjlw/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/mhsjlw"
        }
    },
    "body": "In progress",
    "closed_at": "2015-11-16T18:51:52Z",
    "comment_data": [
        {
            "_links": {
                "html": {
                    "href": "https://github.com/mhsjlw/flying-squid/pull/94#discussion_r44232314"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/mhsjlw/flying-squid/pulls/94"
                },
                "self": {
                    "href": "https://api.github.com/repos/mhsjlw/flying-squid/pulls/comments/44232314"
                }
            },
            "body": "that was a test, remove it ;)",
            "commit_id": "738ac51ce25cf895c70dea5e59103de0b2de3a46",
            "created_at": "2015-11-08T22:59:14Z",
            "diff_hunk": "@@ -47,7 +47,7 @@ function inject(serv,player)\n \n   function sendRelativePositionChange(newPosition, onGround) {\n     if (player.entity.position.distanceTo(new vec3(0, 0, 0)) != 0) {\n-      var diff = newPosition.minus(player.entity.position);\n+      var diff = newPosition.scaled(1/32).scaled(32).minus(player.entity.position.scaled(1/32).scaled(32));",
            "html_url": "https://github.com/mhsjlw/flying-squid/pull/94#discussion_r44232314",
            "id": 44232314,
            "original_commit_id": "687b8b971fa315437a7dad98be98a58672d8068d",
            "original_position": 18,
            "path": "src/lib/playerPlugins/updatePositions.js",
            "position": null,
            "pull_request_url": "https://api.github.com/repos/mhsjlw/flying-squid/pulls/94",
            "updated_at": "2015-11-11T20:41:27Z",
            "url": "https://api.github.com/repos/mhsjlw/flying-squid/pulls/comments/44232314",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2346494?v=3",
                "events_url": "https://api.github.com/users/rom1504/events{/privacy}",
                "followers_url": "https://api.github.com/users/rom1504/followers",
                "following_url": "https://api.github.com/users/rom1504/following{/other_user}",
                "gists_url": "https://api.github.com/users/rom1504/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/rom1504",
                "id": 2346494,
                "login": "rom1504",
                "organizations_url": "https://api.github.com/users/rom1504/orgs",
                "received_events_url": "https://api.github.com/users/rom1504/received_events",
                "repos_url": "https://api.github.com/users/rom1504/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/rom1504/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/rom1504/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/rom1504"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/mhsjlw/flying-squid/pull/94#discussion_r44520153"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/mhsjlw/flying-squid/pulls/94"
                },
                "self": {
                    "href": "https://api.github.com/repos/mhsjlw/flying-squid/pulls/comments/44520153"
                }
            },
            "body": "no, there is no (), that's indeed player.nearbyPlayers\r\n\r\nedit: nevermind, but read the other comment",
            "commit_id": "738ac51ce25cf895c70dea5e59103de0b2de3a46",
            "created_at": "2015-11-11T10:43:06Z",
            "diff_hunk": "@@ -8,15 +8,17 @@ function inject(serv,player)\n       .forEach((otherPlayer) => otherPlayer._client.write(packetName, packetFields));\n \n   player._writeOthersNearby = (packetName, packetFields) =>\n-    serv._writeArray(packetName, packetFields, player.nearbyPlayers);\n+    serv._writeArray(packetName, packetFields, player.nearbyPlayers());",
            "html_url": "https://github.com/mhsjlw/flying-squid/pull/94#discussion_r44520153",
            "id": 44520153,
            "original_commit_id": "f0c17d38b4f950f3f04af0315540a510fd56334e",
            "original_position": 5,
            "path": "src/lib/playerPlugins/communication.js",
            "position": 5,
            "pull_request_url": "https://api.github.com/repos/mhsjlw/flying-squid/pulls/94",
            "updated_at": "2015-11-11T20:41:27Z",
            "url": "https://api.github.com/repos/mhsjlw/flying-squid/pulls/comments/44520153",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2346494?v=3",
                "events_url": "https://api.github.com/users/rom1504/events{/privacy}",
                "followers_url": "https://api.github.com/users/rom1504/followers",
                "following_url": "https://api.github.com/users/rom1504/following{/other_user}",
                "gists_url": "https://api.github.com/users/rom1504/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/rom1504",
                "id": 2346494,
                "login": "rom1504",
                "organizations_url": "https://api.github.com/users/rom1504/orgs",
                "received_events_url": "https://api.github.com/users/rom1504/received_events",
                "repos_url": "https://api.github.com/users/rom1504/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/rom1504/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/rom1504/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/rom1504"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/mhsjlw/flying-squid/pull/94#discussion_r44520359"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/mhsjlw/flying-squid/pulls/94"
                },
                "self": {
                    "href": "https://api.github.com/repos/mhsjlw/flying-squid/pulls/comments/44520359"
                }
            },
            "body": "there is no (), that's the point of player.nearbyPlayers\r\n\r\nedit: nevermind, but read the other comment",
            "commit_id": "738ac51ce25cf895c70dea5e59103de0b2de3a46",
            "created_at": "2015-11-11T10:45:51Z",
            "diff_hunk": "@@ -17,7 +21,7 @@ function inject(serv,player)\n           UUID: player._client.uuid\n         }]\n       });\n-      player.nearbyPlayers.forEach(otherPlayer => otherPlayer.despawnPlayers([player]));\n+      player.nearbyPlayers().forEach(otherPlayer => otherPlayer.despawnPlayers([player]));",
            "html_url": "https://github.com/mhsjlw/flying-squid/pull/94#discussion_r44520359",
            "id": 44520359,
            "original_commit_id": "f0c17d38b4f950f3f04af0315540a510fd56334e",
            "original_position": 16,
            "path": "src/lib/playerPlugins/logout.js",
            "position": 16,
            "pull_request_url": "https://api.github.com/repos/mhsjlw/flying-squid/pulls/94",
            "updated_at": "2015-11-11T20:41:27Z",
            "url": "https://api.github.com/repos/mhsjlw/flying-squid/pulls/comments/44520359",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2346494?v=3",
                "events_url": "https://api.github.com/users/rom1504/events{/privacy}",
                "followers_url": "https://api.github.com/users/rom1504/followers",
                "following_url": "https://api.github.com/users/rom1504/following{/other_user}",
                "gists_url": "https://api.github.com/users/rom1504/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/rom1504",
                "id": 2346494,
                "login": "rom1504",
                "organizations_url": "https://api.github.com/users/rom1504/orgs",
                "received_events_url": "https://api.github.com/users/rom1504/received_events",
                "repos_url": "https://api.github.com/users/rom1504/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/rom1504/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/rom1504/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/rom1504"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/mhsjlw/flying-squid/pull/94#discussion_r44520605"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/mhsjlw/flying-squid/pulls/94"
                },
                "self": {
                    "href": "https://api.github.com/repos/mhsjlw/flying-squid/pulls/comments/44520605"
                }
            },
            "body": "the radius cannot be used here, so remove it ;)\r\n\r\nsecond point : it's really confusing to have nearbyPlayers() and getNearbyPlayers()\r\n\r\nit would be better to make it getNearbyPlayers() and computeNearbyPlayers()",
            "commit_id": "738ac51ce25cf895c70dea5e59103de0b2de3a46",
            "created_at": "2015-11-11T10:49:13Z",
            "diff_hunk": "@@ -8,15 +8,17 @@ function inject(serv,player)\n       .forEach((otherPlayer) => otherPlayer._client.write(packetName, packetFields));\n \n   player._writeOthersNearby = (packetName, packetFields) =>\n-    serv._writeArray(packetName, packetFields, player.nearbyPlayers);\n+    serv._writeArray(packetName, packetFields, player.nearbyPlayers());\n \n   player.getOthers = () => serv.players.filter((otherPlayer) => otherPlayer != player);\n \n-  player.getNearby = () => serv\n-    .getNearby({\n-      world: player.world,\n-      position: player.entity.position,\n-      radius: player.playerViewDistance*32\n-    })\n-    .filter((p) => p != player);\n+  player.getNearbyPlayers = (radius=player.entity.viewDistance*32) => serv.getNearby({\n+    world: player.world,\n+    position: player.position,\n+    radius: radius\n+  });\n+\n+  player.nearbyPlayers = (radius=player.entity.viewDistance*32) => player.entity.nearbyEntities",
            "html_url": "https://github.com/mhsjlw/flying-squid/pull/94#discussion_r44520605",
            "id": 44520605,
            "original_commit_id": "f0c17d38b4f950f3f04af0315540a510fd56334e",
            "original_position": 22,
            "path": "src/lib/playerPlugins/communication.js",
            "position": 22,
            "pull_request_url": "https://api.github.com/repos/mhsjlw/flying-squid/pulls/94",
            "updated_at": "2015-11-11T20:41:27Z",
            "url": "https://api.github.com/repos/mhsjlw/flying-squid/pulls/comments/44520605",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2346494?v=3",
                "events_url": "https://api.github.com/users/rom1504/events{/privacy}",
                "followers_url": "https://api.github.com/users/rom1504/followers",
                "following_url": "https://api.github.com/users/rom1504/following{/other_user}",
                "gists_url": "https://api.github.com/users/rom1504/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/rom1504",
                "id": 2346494,
                "login": "rom1504",
                "organizations_url": "https://api.github.com/users/rom1504/orgs",
                "received_events_url": "https://api.github.com/users/rom1504/received_events",
                "repos_url": "https://api.github.com/users/rom1504/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/rom1504/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/rom1504/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/rom1504"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/mhsjlw/flying-squid/pull/94#discussion_r44520731"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/mhsjlw/flying-squid/pulls/94"
                },
                "self": {
                    "href": "https://api.github.com/repos/mhsjlw/flying-squid/pulls/comments/44520731"
                }
            },
            "body": "better call itemId,itemDamage as type and metadata as we do in the rest of flying-squid\r\nOr anyway itemType and itemMetadata.\r\n\r\nLater I'll make prismarine-item (https://github.com/andrewrk/mineflayer/blob/master/lib/item.js#L54) and we'll use it there.\r\n\r\nSo I did prismarine-item in the end ( https://github.com/PrismarineJS/prismarine-item ), feel free to use it in that PR, but it's not necessary, I'll make the changes once that PR get merged if you don't do it ;)",
            "commit_id": "738ac51ce25cf895c70dea5e59103de0b2de3a46",
            "created_at": "2015-11-11T10:50:45Z",
            "diff_hunk": "@@ -0,0 +1,280 @@\n+var Entity=require(\"prismarine-entity\");\n+var blocks=require(\"minecraft-data\")(require(\"../version\")).blocks;\n+var mobs=require(\"minecraft-data\")(require(\"../version\")).entitiesByName;\n+var vec3 = require(\"vec3\");\n+var EventEmitter = require('events').EventEmitter;\n+var util = require('util');\n+\n+module.exports = inject;\n+\n+function inject(serv) {\n+\n+  util.inherits(Entity, EventEmitter);\n+\n+  serv.initEntity = (type, entityType, world, position) => {\n+    serv.entityMaxId++;\n+    var entity = new Entity(serv.entityMaxId);\n+    EventEmitter.call(entity);\n+    entity.type = type;\n+    entity.spawnPacketName = '';\n+    entity.entityType = entityType;\n+    entity.world = world;\n+    entity.position = position;\n+    entity.lastPositionPlayersUpdated = entity.position.clone();\n+    entity.nearbyEntities = [];\n+    entity.viewDistance = 150;\n+\n+    entity.bornTime = Date.now();\n+    serv.entities[entity.id] = entity;\n+\n+    if (entity.type == 'player') entity.spawnPacketName = 'named_entity_spawn';\n+    else if (entity.type == 'object') entity.spawnPacketName = 'spawn_entity';\n+    else if (entity.type == 'mob') entity.spawnPacketName = 'spawn_entity_living';\n+\n+    entity.on(\"positionChanged\",() => {\n+      if(entity.position.distanceTo(entity.lastPositionPlayersUpdated)>2*32)\n+        entity.updateAndSpawn();\n+    });\n+\n+    entity.setMetadata = (data) => {\n+      serv._writeNearby('entity_metadata', {\n+        entityId: entity.id,\n+        metadata: data\n+      }, entity);\n+    };\n+\n+    entity.destroy = () => {\n+      serv.destroyEntity(entity);\n+    };\n+\n+    entity.calculatePhysics = async (delta) => {\n+      if (entity.gravity) {\n+        addGravity(entity, 'x', delta);\n+        addGravity(entity, 'y', delta);\n+        addGravity(entity, 'z', delta);\n+      }\n+\n+      var vSign = getSign(entity.velocity);\n+      var sizeSigned = vec3(vSign.x * entity.size.x, vSign.y * entity.size.y, vSign.z * entity.size.z);\n+\n+      var xVec = entity.position.offset(entity.velocity.x*delta + sizeSigned.x/2, 0, 0).scaled(1/32).floored();\n+      var yVec = entity.position.offset(0, entity.velocity.y*delta + sizeSigned.y/2, 0).scaled(1/32).floored();\n+      var zVec = entity.position.offset(0, 0, entity.velocity.z*delta + sizeSigned.z/2).scaled(1/32).floored();\n+\n+      // Get block for each (x/y/z)Vec, check to avoid duplicate getBlockTypes\n+      var xBlock = blocks[await entity.world.getBlockType(xVec)].boundingBox == 'block';\n+      var yBlock = yVec.equals(xVec) ? xBlock : blocks[await entity.world.getBlockType(yVec)].boundingBox == 'block';\n+      var zBlock = zVec.equals(yVec) ? yBlock : (zVec.equals(xVec) ? xBlock : blocks[await entity.world.getBlockType(zVec)].boundingBox == 'block');\n+\n+      var old = entity.position.clone();\n+\n+      if (xBlock || yBlock || zBlock) {\n+        entity.velocity.x = getFriction(entity.velocity.x, entity.friction.x, delta);\n+        entity.velocity.z = getFriction(entity.velocity.x, entity.friction.x, delta);\n+      }\n+\n+      var oldPos = entity.position.clone();\n+\n+      entity.position.x += getMoveAmount('x', xBlock, entity, delta, sizeSigned.x);\n+      entity.position.y += getMoveAmount('y', yBlock, entity, delta, sizeSigned.y);\n+      entity.position.z += getMoveAmount('z', zBlock, entity, delta, sizeSigned.z);\n+\n+      //serv.emitParticle(30, serv.overworld, entity.position.scaled(1/32), { size: vec3(0, 0, 0) });\n+      return { oldPos: oldPos, onGround: yBlock}\n+    };\n+\n+    entity.sendPosition = ({oldPos,onGround}) => {\n+      var diff = entity.position.minus(oldPos);\n+\n+      if(diff.abs().x>127 || diff.abs().y>127 || diff.abs().z>127) \n+        serv._writeNearby('entity_teleport', {\n+          entityId: entity.id,\n+          x: entity.position.x,\n+          y: entity.position.y,\n+          z: entity.position.z,\n+          yaw: entity.yaw,\n+          pitch: entity.pitch,\n+          onGround: onGround\n+        }, entity);\n+      else serv._writeNearby('rel_entity_move', {\n+          entityId: entity.id,\n+          dX: diff.x,\n+          dY: diff.y,\n+          dZ: diff.z,\n+          onGround: onGround\n+        }, entity);\n+\n+      entity.emit('positionChanged', oldPos);\n+    }\n+\n+    entity.getSpawnPacket = () => {\n+      var scaledVelocity = entity.velocity.scaled(8000/32/20).floored(); // from fixed-position/second to unit => 1/8000 blocks per tick\n+      if (entity.type == 'player') {\n+        return {\n+          entityId: entity.id,\n+          playerUUID: entity.player._client.uuid,\n+          x: entity.position.x,\n+          y: entity.position.y,\n+          z: entity.position.z,\n+          yaw: entity.yaw,\n+          pitch: entity.pitch,\n+          currentItem: 0,\n+          metadata: entity.metadata\n+        }\n+      } else if (entity.type == 'object') {\n+        return {\n+          entityId: entity.id,\n+          type: entity.entityType,\n+          x: entity.position.x,\n+          y: entity.position.y,\n+          z: entity.position.z,\n+          pitch: entity.pitch,\n+          yaw: entity.yaw,\n+          objectData: {\n+            intField: entity.data,\n+            velocityX: scaledVelocity.x,\n+            velocityY: scaledVelocity.y,\n+            velocityZ: scaledVelocity.z\n+          }\n+        }\n+      } else if (entity.type == 'mob') {\n+        return {\n+          entityId: entity.id,\n+          type: entity.entityType,\n+          x: entity.position.x,\n+          y: entity.position.y,\n+          z: entity.position.z,\n+          yaw: entity.yaw,\n+          pitch: entity.pitch,\n+          headPitch: entity.headPitch,\n+          velocityX: scaledVelocity.x,\n+          velocityY: scaledVelocity.y,\n+          velocityZ: scaledVelocity.z,\n+          metadata: entity.metadata\n+        }\n+      }\n+    };\n+\n+    entity.getNearby = () => serv\n+      .getNearbyEntities({\n+        world: entity.world,\n+        position: entity.position,\n+        radius: entity.viewDistance*32\n+      })\n+      .filter((e) => e != entity);\n+\n+    entity.updateAndSpawn = () => {\n+      var updatedEntities=entity.getNearby();\n+      var entitiesToAdd=updatedEntities.filter(e => entity.nearbyEntities.indexOf(e)==-1);\n+      var entitiesToRemove=entity.nearbyEntities.filter(e => updatedEntities.indexOf(e)==-1);\n+      if (entity.type == 'player') {\n+        entity.player.despawnEntities(entitiesToRemove);\n+        entitiesToAdd.forEach(entity.player.spawnEntity);\n+        entity.player.lastPositionPlayersUpdated=entity.position.clone();\n+      } else {\n+        entity.lastPositionPlayersUpdated=entity.position.clone();\n+      }\n+\n+      var playersToAdd = entitiesToAdd.filter(e => e.type == 'player').map(e => e.player);\n+      var playersToRemove = entitiesToRemove.filter(e => e.type == 'player').map(e => e.player);\n+\n+      playersToRemove.forEach(p => p.despawnEntities([entity]));\n+      playersToRemove.forEach(p => p.entity.nearbyEntities=p.entity.getNearby());\n+      playersToAdd.forEach(p => p.spawnEntity(entity));\n+      playersToAdd.forEach(p => p.entity.nearbyEntities=p.entity.getNearby());\n+\n+      entity.nearbyEntities=updatedEntities;\n+    };\n+\n+    return entity;\n+  }\n+\n+  serv.spawnObject = (type, world, position, {pitch=0,yaw=0,velocity=vec3(0,0,0),data=1,itemId,itemDamage=0}={}) => {",
            "html_url": "https://github.com/mhsjlw/flying-squid/pull/94#discussion_r44520731",
            "id": 44520731,
            "original_commit_id": "f0c17d38b4f950f3f04af0315540a510fd56334e",
            "original_position": 192,
            "path": "src/lib/serverPlugins/entities.js",
            "position": 192,
            "pull_request_url": "https://api.github.com/repos/mhsjlw/flying-squid/pulls/94",
            "updated_at": "2015-11-11T20:41:27Z",
            "url": "https://api.github.com/repos/mhsjlw/flying-squid/pulls/comments/44520731",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2346494?v=3",
                "events_url": "https://api.github.com/users/rom1504/events{/privacy}",
                "followers_url": "https://api.github.com/users/rom1504/followers",
                "following_url": "https://api.github.com/users/rom1504/following{/other_user}",
                "gists_url": "https://api.github.com/users/rom1504/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/rom1504",
                "id": 2346494,
                "login": "rom1504",
                "organizations_url": "https://api.github.com/users/rom1504/orgs",
                "received_events_url": "https://api.github.com/users/rom1504/received_events",
                "repos_url": "https://api.github.com/users/rom1504/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/rom1504/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/rom1504/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/rom1504"
            }
        }
    ],
    "comments_url": "https://api.github.com/repos/mhsjlw/flying-squid/issues/94/comments",
    "commit_data": [
        {
            "author": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7506359?v=3",
                "events_url": "https://api.github.com/users/demipixel/events{/privacy}",
                "followers_url": "https://api.github.com/users/demipixel/followers",
                "following_url": "https://api.github.com/users/demipixel/following{/other_user}",
                "gists_url": "https://api.github.com/users/demipixel/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/demipixel",
                "id": 7506359,
                "login": "demipixel",
                "organizations_url": "https://api.github.com/users/demipixel/orgs",
                "received_events_url": "https://api.github.com/users/demipixel/received_events",
                "repos_url": "https://api.github.com/users/demipixel/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/demipixel/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/demipixel/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/demipixel"
            },
            "comments_url": "https://api.github.com/repos/mhsjlw/flying-squid/commits/738ac51ce25cf895c70dea5e59103de0b2de3a46/comments",
            "commit": {
                "author": {
                    "date": "2015-11-11T20:41:26Z",
                    "email": "demipixel@users.noreply.github.com",
                    "name": "demipixel"
                },
                "comment_count": 0,
                "committer": {
                    "date": "2015-11-11T20:41:26Z",
                    "email": "demipixel@users.noreply.github.com",
                    "name": "demipixel"
                },
                "message": "Merge pull request #2 from rom1504/fix_blockdrop\n\nfix block drop (use currentlyDugBlock instead of getting air)",
                "tree": {
                    "sha": "e5939a948e892b2cdec2d29272966fb2a371a7fc",
                    "url": "https://api.github.com/repos/mhsjlw/flying-squid/git/trees/e5939a948e892b2cdec2d29272966fb2a371a7fc"
                },
                "url": "https://api.github.com/repos/mhsjlw/flying-squid/git/commits/738ac51ce25cf895c70dea5e59103de0b2de3a46"
            },
            "committer": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7506359?v=3",
                "events_url": "https://api.github.com/users/demipixel/events{/privacy}",
                "followers_url": "https://api.github.com/users/demipixel/followers",
                "following_url": "https://api.github.com/users/demipixel/following{/other_user}",
                "gists_url": "https://api.github.com/users/demipixel/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/demipixel",
                "id": 7506359,
                "login": "demipixel",
                "organizations_url": "https://api.github.com/users/demipixel/orgs",
                "received_events_url": "https://api.github.com/users/demipixel/received_events",
                "repos_url": "https://api.github.com/users/demipixel/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/demipixel/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/demipixel/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/demipixel"
            },
            "html_url": "https://github.com/mhsjlw/flying-squid/commit/738ac51ce25cf895c70dea5e59103de0b2de3a46",
            "parents": [
                {
                    "html_url": "https://github.com/mhsjlw/flying-squid/commit/f0c17d38b4f950f3f04af0315540a510fd56334e",
                    "sha": "f0c17d38b4f950f3f04af0315540a510fd56334e",
                    "url": "https://api.github.com/repos/mhsjlw/flying-squid/commits/f0c17d38b4f950f3f04af0315540a510fd56334e"
                },
                {
                    "html_url": "https://github.com/mhsjlw/flying-squid/commit/47b6e00d5ed9625edf630503bc2261a91036f600",
                    "sha": "47b6e00d5ed9625edf630503bc2261a91036f600",
                    "url": "https://api.github.com/repos/mhsjlw/flying-squid/commits/47b6e00d5ed9625edf630503bc2261a91036f600"
                }
            ],
            "sha": "738ac51ce25cf895c70dea5e59103de0b2de3a46",
            "url": "https://api.github.com/repos/mhsjlw/flying-squid/commits/738ac51ce25cf895c70dea5e59103de0b2de3a46"
        }
    ],
    "commits_url": "https://api.github.com/repos/mhsjlw/flying-squid/pulls/94/commits",
    "created_at": "2015-11-08T01:50:23Z",
    "diff_url": "https://github.com/mhsjlw/flying-squid/pull/94.diff",
    "head": {
        "label": "demipixel:blockdrop",
        "ref": "blockdrop",
        "repo": {
            "archive_url": "https://api.github.com/repos/demipixel/flying-squid/{archive_format}{/ref}",
            "assignees_url": "https://api.github.com/repos/demipixel/flying-squid/assignees{/user}",
            "blobs_url": "https://api.github.com/repos/demipixel/flying-squid/git/blobs{/sha}",
            "branches_url": "https://api.github.com/repos/demipixel/flying-squid/branches{/branch}",
            "clone_url": "https://github.com/demipixel/flying-squid.git",
            "collaborators_url": "https://api.github.com/repos/demipixel/flying-squid/collaborators{/collaborator}",
            "comments_url": "https://api.github.com/repos/demipixel/flying-squid/comments{/number}",
            "commits_url": "https://api.github.com/repos/demipixel/flying-squid/commits{/sha}",
            "compare_url": "https://api.github.com/repos/demipixel/flying-squid/compare/{base}...{head}",
            "contents_url": "https://api.github.com/repos/demipixel/flying-squid/contents/{+path}",
            "contributors_url": "https://api.github.com/repos/demipixel/flying-squid/contributors",
            "created_at": "2015-09-05T23:57:08Z",
            "default_branch": "master",
            "description": "A minecraft server written in node.js, modularized",
            "downloads_url": "https://api.github.com/repos/demipixel/flying-squid/downloads",
            "events_url": "https://api.github.com/repos/demipixel/flying-squid/events",
            "fork": true,
            "forks": 0,
            "forks_count": 0,
            "forks_url": "https://api.github.com/repos/demipixel/flying-squid/forks",
            "full_name": "demipixel/flying-squid",
            "git_commits_url": "https://api.github.com/repos/demipixel/flying-squid/git/commits{/sha}",
            "git_refs_url": "https://api.github.com/repos/demipixel/flying-squid/git/refs{/sha}",
            "git_tags_url": "https://api.github.com/repos/demipixel/flying-squid/git/tags{/sha}",
            "git_url": "git://github.com/demipixel/flying-squid.git",
            "has_downloads": true,
            "has_issues": false,
            "has_pages": false,
            "has_wiki": true,
            "homepage": "",
            "hooks_url": "https://api.github.com/repos/demipixel/flying-squid/hooks",
            "html_url": "https://github.com/demipixel/flying-squid",
            "id": 41980022,
            "issue_comment_url": "https://api.github.com/repos/demipixel/flying-squid/issues/comments{/number}",
            "issue_events_url": "https://api.github.com/repos/demipixel/flying-squid/issues/events{/number}",
            "issues_url": "https://api.github.com/repos/demipixel/flying-squid/issues{/number}",
            "keys_url": "https://api.github.com/repos/demipixel/flying-squid/keys{/key_id}",
            "labels_url": "https://api.github.com/repos/demipixel/flying-squid/labels{/name}",
            "language": "JavaScript",
            "languages_url": "https://api.github.com/repos/demipixel/flying-squid/languages",
            "merges_url": "https://api.github.com/repos/demipixel/flying-squid/merges",
            "milestones_url": "https://api.github.com/repos/demipixel/flying-squid/milestones{/number}",
            "mirror_url": null,
            "name": "flying-squid",
            "notifications_url": "https://api.github.com/repos/demipixel/flying-squid/notifications{?since,all,participating}",
            "open_issues": 0,
            "open_issues_count": 0,
            "owner": {
                "avatar_url": "https://avatars.githubusercontent.com/u/7506359?v=3",
                "events_url": "https://api.github.com/users/demipixel/events{/privacy}",
                "followers_url": "https://api.github.com/users/demipixel/followers",
                "following_url": "https://api.github.com/users/demipixel/following{/other_user}",
                "gists_url": "https://api.github.com/users/demipixel/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/demipixel",
                "id": 7506359,
                "login": "demipixel",
                "organizations_url": "https://api.github.com/users/demipixel/orgs",
                "received_events_url": "https://api.github.com/users/demipixel/received_events",
                "repos_url": "https://api.github.com/users/demipixel/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/demipixel/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/demipixel/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/demipixel"
            },
            "private": false,
            "pulls_url": "https://api.github.com/repos/demipixel/flying-squid/pulls{/number}",
            "pushed_at": "2015-12-14T18:42:50Z",
            "releases_url": "https://api.github.com/repos/demipixel/flying-squid/releases{/id}",
            "size": 478,
            "ssh_url": "git@github.com:demipixel/flying-squid.git",
            "stargazers_count": 0,
            "stargazers_url": "https://api.github.com/repos/demipixel/flying-squid/stargazers",
            "statuses_url": "https://api.github.com/repos/demipixel/flying-squid/statuses/{sha}",
            "subscribers_url": "https://api.github.com/repos/demipixel/flying-squid/subscribers",
            "subscription_url": "https://api.github.com/repos/demipixel/flying-squid/subscription",
            "svn_url": "https://github.com/demipixel/flying-squid",
            "tags_url": "https://api.github.com/repos/demipixel/flying-squid/tags",
            "teams_url": "https://api.github.com/repos/demipixel/flying-squid/teams",
            "trees_url": "https://api.github.com/repos/demipixel/flying-squid/git/trees{/sha}",
            "updated_at": "2015-09-05T23:57:10Z",
            "url": "https://api.github.com/repos/demipixel/flying-squid",
            "watchers": 0,
            "watchers_count": 0
        },
        "sha": "738ac51ce25cf895c70dea5e59103de0b2de3a46",
        "user": {
            "avatar_url": "https://avatars.githubusercontent.com/u/7506359?v=3",
            "events_url": "https://api.github.com/users/demipixel/events{/privacy}",
            "followers_url": "https://api.github.com/users/demipixel/followers",
            "following_url": "https://api.github.com/users/demipixel/following{/other_user}",
            "gists_url": "https://api.github.com/users/demipixel/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/demipixel",
            "id": 7506359,
            "login": "demipixel",
            "organizations_url": "https://api.github.com/users/demipixel/orgs",
            "received_events_url": "https://api.github.com/users/demipixel/received_events",
            "repos_url": "https://api.github.com/users/demipixel/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/demipixel/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/demipixel/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/demipixel"
        }
    },
    "html_url": "https://github.com/mhsjlw/flying-squid/pull/94",
    "id": 50050561,
    "issue_url": "https://api.github.com/repos/mhsjlw/flying-squid/issues/94",
    "locked": false,
    "merge_commit_sha": "03fb5bb9a8f222f506e77f884aefe696d37f59b2",
    "merged_at": "2015-11-16T18:51:52Z",
    "milestone": null,
    "number": 94,
    "patch_url": "https://github.com/mhsjlw/flying-squid/pull/94.patch",
    "review_comment_url": "https://api.github.com/repos/mhsjlw/flying-squid/pulls/comments{/number}",
    "review_comments_url": "https://api.github.com/repos/mhsjlw/flying-squid/pulls/94/comments",
    "state": "closed",
    "statuses_url": "https://api.github.com/repos/mhsjlw/flying-squid/statuses/738ac51ce25cf895c70dea5e59103de0b2de3a46",
    "title": "Entities and Physics",
    "updated_at": "2015-11-17T07:13:12Z",
    "url": "https://api.github.com/repos/mhsjlw/flying-squid/pulls/94",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/7506359?v=3",
        "events_url": "https://api.github.com/users/demipixel/events{/privacy}",
        "followers_url": "https://api.github.com/users/demipixel/followers",
        "following_url": "https://api.github.com/users/demipixel/following{/other_user}",
        "gists_url": "https://api.github.com/users/demipixel/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/demipixel",
        "id": 7506359,
        "login": "demipixel",
        "organizations_url": "https://api.github.com/users/demipixel/orgs",
        "received_events_url": "https://api.github.com/users/demipixel/received_events",
        "repos_url": "https://api.github.com/users/demipixel/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/demipixel/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/demipixel/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/demipixel"
    }
}