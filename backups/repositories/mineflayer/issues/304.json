{
    "assignee": null,
    "body": "Using BlockFinder plugin I wrote a simple script to find nearby unlit blocks (those that allow mob spawning) and announce the coordinates and type of the darkest one of these. However as I place torches, the bot still announces the same blocks. Something is wrong with `block.light`. Maybe spigot server isn't sending it correctly?\r\n\r\n     //Install block finder\r\n     blockFinderPlugin(bot);\r\n     bot.findBlock({\r\n      point: bot.entity.position,\r\n      matching: function(block) {\r\n        //Ignore 8 and brighter\r\n        if(block.light>7)\r\n          return false;\r\n        //Ignore air\r\n        if(block.type==0)\r\n          return false;\r\n        //Check if there isn't block right above it\r\n        //If there's a block above, the torch can't be placed anyway and monsters can't spawn\r\n        var pos = vec3(block.position);\r\n        pos.y++;\r\n        \r\n        var obstruction=bot.blockAt(pos);\r\n        if(obstruction!=null && obstruction.type!=0) {\r\n          //console.log(block.position+\" is obstructed by \"+obstruction.displayName);\r\n          return false;     \r\n        }\r\n        return true;\r\n      },\r\n      maxDistance: 20,\r\n      count: 6,\r\n    }, function(err, blocks) {\r\n      if (err) {\r\n        bot.chat('Error trying to find unlit blocks: ' + err);\r\n        _this.setError(1, err);\r\n      }\r\n      else if (blocks.length) {\r\n        //Sort the found blocks from darkest to lightest\r\n        blocks.sort(function(a,b){return a.light-b.light});\r\n        bot.chat('I found an unlit '+blocks[0].displayName+' block at ' + blocks[0].position + ' - It has light of '+blocks[0].light);      \r\n        //return;\r\n      } else {\r\n        bot.chat(\"I couldn't find any unlit blocks.\");\r\n      }\r\n      _this.finished();\r\n    });",
    "closed_at": null,
    "comment_data": [
        {
            "body": "Can you try to reproduce this with a vanilla server ? (it's well possible we are not getting the light correctly, I don't think anybody ever used this before)",
            "created_at": "2015-07-11T11:21:24Z",
            "html_url": "https://github.com/PrismarineJS/mineflayer/issues/304#issuecomment-120605479",
            "id": 120605479,
            "issue_url": "https://api.github.com/repos/PrismarineJS/mineflayer/issues/304",
            "updated_at": "2015-07-11T11:21:50Z",
            "url": "https://api.github.com/repos/PrismarineJS/mineflayer/issues/comments/120605479",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2346494?v=3",
                "events_url": "https://api.github.com/users/rom1504/events{/privacy}",
                "followers_url": "https://api.github.com/users/rom1504/followers",
                "following_url": "https://api.github.com/users/rom1504/following{/other_user}",
                "gists_url": "https://api.github.com/users/rom1504/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/rom1504",
                "id": 2346494,
                "login": "rom1504",
                "organizations_url": "https://api.github.com/users/rom1504/orgs",
                "received_events_url": "https://api.github.com/users/rom1504/received_events",
                "repos_url": "https://api.github.com/users/rom1504/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/rom1504/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/rom1504/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/rom1504"
            }
        },
        {
            "body": "Tried on vanilla, it's the same. Also, nobody really uses vanilla... It almost crashed my computer by it's CPU usage and has broken GUI.\r\n\r\n![vanilla screenshot](http://i.imgur.com/V6JEo2t.png)",
            "created_at": "2015-07-11T17:37:37Z",
            "html_url": "https://github.com/PrismarineJS/mineflayer/issues/304#issuecomment-120647071",
            "id": 120647071,
            "issue_url": "https://api.github.com/repos/PrismarineJS/mineflayer/issues/304",
            "updated_at": "2015-07-11T17:37:54Z",
            "url": "https://api.github.com/repos/PrismarineJS/mineflayer/issues/comments/120647071",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5508988?v=3",
                "events_url": "https://api.github.com/users/Darker/events{/privacy}",
                "followers_url": "https://api.github.com/users/Darker/followers",
                "following_url": "https://api.github.com/users/Darker/following{/other_user}",
                "gists_url": "https://api.github.com/users/Darker/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Darker",
                "id": 5508988,
                "login": "Darker",
                "organizations_url": "https://api.github.com/users/Darker/orgs",
                "received_events_url": "https://api.github.com/users/Darker/received_events",
                "repos_url": "https://api.github.com/users/Darker/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Darker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Darker/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Darker"
            }
        },
        {
            "body": "Restarting server or reloging has no effect. The light is allways 0.",
            "created_at": "2015-07-11T17:41:37Z",
            "html_url": "https://github.com/PrismarineJS/mineflayer/issues/304#issuecomment-120647670",
            "id": 120647670,
            "issue_url": "https://api.github.com/repos/PrismarineJS/mineflayer/issues/304",
            "updated_at": "2015-07-11T17:41:37Z",
            "url": "https://api.github.com/repos/PrismarineJS/mineflayer/issues/comments/120647670",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5508988?v=3",
                "events_url": "https://api.github.com/users/Darker/events{/privacy}",
                "followers_url": "https://api.github.com/users/Darker/followers",
                "following_url": "https://api.github.com/users/Darker/following{/other_user}",
                "gists_url": "https://api.github.com/users/Darker/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Darker",
                "id": 5508988,
                "login": "Darker",
                "organizations_url": "https://api.github.com/users/Darker/orgs",
                "received_events_url": "https://api.github.com/users/Darker/received_events",
                "repos_url": "https://api.github.com/users/Darker/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Darker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Darker/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Darker"
            }
        },
        {
            "body": "Vanilla is what we used to test node-mc-proto and mineflayer. That's why we always ask to reproduce on vanilla, allows us to see if it's an impl discrepency or just use doing it wrong ^^",
            "created_at": "2015-07-11T19:21:32Z",
            "html_url": "https://github.com/PrismarineJS/mineflayer/issues/304#issuecomment-120653391",
            "id": 120653391,
            "issue_url": "https://api.github.com/repos/PrismarineJS/mineflayer/issues/304",
            "updated_at": "2015-07-11T19:21:32Z",
            "url": "https://api.github.com/repos/PrismarineJS/mineflayer/issues/comments/120653391",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1069318?v=3",
                "events_url": "https://api.github.com/users/roblabla/events{/privacy}",
                "followers_url": "https://api.github.com/users/roblabla/followers",
                "following_url": "https://api.github.com/users/roblabla/following{/other_user}",
                "gists_url": "https://api.github.com/users/roblabla/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/roblabla",
                "id": 1069318,
                "login": "roblabla",
                "organizations_url": "https://api.github.com/users/roblabla/orgs",
                "received_events_url": "https://api.github.com/users/roblabla/received_events",
                "repos_url": "https://api.github.com/users/roblabla/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/roblabla/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/roblabla/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/roblabla"
            }
        },
        {
            "body": "Ok this is happening both in vanilla and spigot. It also seems that it's not due to block update problem but generally parsing the light value.\r\nIs there anything I can do to hotfix that? I wanted to make a bot that carries light all over certain location.",
            "created_at": "2015-07-12T02:47:17Z",
            "html_url": "https://github.com/PrismarineJS/mineflayer/issues/304#issuecomment-120681519",
            "id": 120681519,
            "issue_url": "https://api.github.com/repos/PrismarineJS/mineflayer/issues/304",
            "updated_at": "2015-07-12T02:47:17Z",
            "url": "https://api.github.com/repos/PrismarineJS/mineflayer/issues/comments/120681519",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5508988?v=3",
                "events_url": "https://api.github.com/users/Darker/events{/privacy}",
                "followers_url": "https://api.github.com/users/Darker/followers",
                "following_url": "https://api.github.com/users/Darker/following{/other_user}",
                "gists_url": "https://api.github.com/users/Darker/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Darker",
                "id": 5508988,
                "login": "Darker",
                "organizations_url": "https://api.github.com/users/Darker/orgs",
                "received_events_url": "https://api.github.com/users/Darker/received_events",
                "repos_url": "https://api.github.com/users/Darker/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Darker/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Darker/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Darker"
            }
        },
        {
            "body": "This might be related to how light is deserialized ( https://github.com/andrewrk/mineflayer/blob/master/lib/plugins/blocks.js#L63 ), might be worth looking into.",
            "created_at": "2015-07-21T05:05:32Z",
            "html_url": "https://github.com/PrismarineJS/mineflayer/issues/304#issuecomment-123161867",
            "id": 123161867,
            "issue_url": "https://api.github.com/repos/PrismarineJS/mineflayer/issues/304",
            "updated_at": "2015-07-21T05:05:32Z",
            "url": "https://api.github.com/repos/PrismarineJS/mineflayer/issues/comments/123161867",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2346494?v=3",
                "events_url": "https://api.github.com/users/rom1504/events{/privacy}",
                "followers_url": "https://api.github.com/users/rom1504/followers",
                "following_url": "https://api.github.com/users/rom1504/following{/other_user}",
                "gists_url": "https://api.github.com/users/rom1504/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/rom1504",
                "id": 2346494,
                "login": "rom1504",
                "organizations_url": "https://api.github.com/users/rom1504/orgs",
                "received_events_url": "https://api.github.com/users/rom1504/received_events",
                "repos_url": "https://api.github.com/users/rom1504/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/rom1504/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/rom1504/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/rom1504"
            }
        },
        {
            "body": "Ok so I can confirm light is broken, I added an information in chatterbox to check this (with the block command).\r\nI believe the problem is in addColumn (https://github.com/andrewrk/mineflayer/blob/master/lib/plugins/blocks.js#L64) or blockAt (https://github.com/andrewrk/mineflayer/blob/master/lib/plugins/blocks.js#L143) but bitwise operations aren't really my thing. Maybe you can spot something @roblabla ?",
            "created_at": "2015-07-22T23:29:57Z",
            "html_url": "https://github.com/PrismarineJS/mineflayer/issues/304#issuecomment-123905658",
            "id": 123905658,
            "issue_url": "https://api.github.com/repos/PrismarineJS/mineflayer/issues/304",
            "updated_at": "2015-07-22T23:29:57Z",
            "url": "https://api.github.com/repos/PrismarineJS/mineflayer/issues/comments/123905658",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2346494?v=3",
                "events_url": "https://api.github.com/users/rom1504/events{/privacy}",
                "followers_url": "https://api.github.com/users/rom1504/followers",
                "following_url": "https://api.github.com/users/rom1504/following{/other_user}",
                "gists_url": "https://api.github.com/users/rom1504/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/rom1504",
                "id": 2346494,
                "login": "rom1504",
                "organizations_url": "https://api.github.com/users/rom1504/orgs",
                "received_events_url": "https://api.github.com/users/rom1504/received_events",
                "repos_url": "https://api.github.com/users/rom1504/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/rom1504/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/rom1504/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/rom1504"
            }
        },
        {
            "body": "Will be fixed by #334 ",
            "created_at": "2015-11-13T22:06:43Z",
            "html_url": "https://github.com/PrismarineJS/mineflayer/issues/304#issuecomment-156572339",
            "id": 156572339,
            "issue_url": "https://api.github.com/repos/PrismarineJS/mineflayer/issues/304",
            "updated_at": "2015-11-13T22:06:43Z",
            "url": "https://api.github.com/repos/PrismarineJS/mineflayer/issues/comments/156572339",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2346494?v=3",
                "events_url": "https://api.github.com/users/rom1504/events{/privacy}",
                "followers_url": "https://api.github.com/users/rom1504/followers",
                "following_url": "https://api.github.com/users/rom1504/following{/other_user}",
                "gists_url": "https://api.github.com/users/rom1504/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/rom1504",
                "id": 2346494,
                "login": "rom1504",
                "organizations_url": "https://api.github.com/users/rom1504/orgs",
                "received_events_url": "https://api.github.com/users/rom1504/received_events",
                "repos_url": "https://api.github.com/users/rom1504/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/rom1504/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/rom1504/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/rom1504"
            }
        },
        {
            "body": "reason why : https://github.com/PrismarineJS/mineflayer/blob/master/lib/plugins/blocks.js#L64\r\nlights are half-bytes, not full.\r\n\r\nWays to fix that:\r\n1. fix it directly\r\n2. use prismarine-world in mineflayer\r\n\r\nI prefer 2 since that's what we will do eventually anyway.",
            "created_at": "2016-01-07T09:50:41Z",
            "html_url": "https://github.com/PrismarineJS/mineflayer/issues/304#issuecomment-169612898",
            "id": 169612898,
            "issue_url": "https://api.github.com/repos/PrismarineJS/mineflayer/issues/304",
            "updated_at": "2016-01-07T09:50:41Z",
            "url": "https://api.github.com/repos/PrismarineJS/mineflayer/issues/comments/169612898",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2346494?v=3",
                "events_url": "https://api.github.com/users/rom1504/events{/privacy}",
                "followers_url": "https://api.github.com/users/rom1504/followers",
                "following_url": "https://api.github.com/users/rom1504/following{/other_user}",
                "gists_url": "https://api.github.com/users/rom1504/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/rom1504",
                "id": 2346494,
                "login": "rom1504",
                "organizations_url": "https://api.github.com/users/rom1504/orgs",
                "received_events_url": "https://api.github.com/users/rom1504/received_events",
                "repos_url": "https://api.github.com/users/rom1504/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/rom1504/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/rom1504/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/rom1504"
            }
        }
    ],
    "comments": 9,
    "comments_url": "https://api.github.com/repos/PrismarineJS/mineflayer/issues/304/comments",
    "created_at": "2015-07-10T16:33:01Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2346494?v=3",
                "events_url": "https://api.github.com/users/rom1504/events{/privacy}",
                "followers_url": "https://api.github.com/users/rom1504/followers",
                "following_url": "https://api.github.com/users/rom1504/following{/other_user}",
                "gists_url": "https://api.github.com/users/rom1504/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/rom1504",
                "id": 2346494,
                "login": "rom1504",
                "organizations_url": "https://api.github.com/users/rom1504/orgs",
                "received_events_url": "https://api.github.com/users/rom1504/received_events",
                "repos_url": "https://api.github.com/users/rom1504/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/rom1504/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/rom1504/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/rom1504"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2015-07-21T05:05:42Z",
            "event": "labeled",
            "id": 360771765,
            "label": {
                "color": "5319e7",
                "name": "block"
            },
            "url": "https://api.github.com/repos/PrismarineJS/mineflayer/issues/events/360771765"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2346494?v=3",
                "events_url": "https://api.github.com/users/rom1504/events{/privacy}",
                "followers_url": "https://api.github.com/users/rom1504/followers",
                "following_url": "https://api.github.com/users/rom1504/following{/other_user}",
                "gists_url": "https://api.github.com/users/rom1504/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/rom1504",
                "id": 2346494,
                "login": "rom1504",
                "organizations_url": "https://api.github.com/users/rom1504/orgs",
                "received_events_url": "https://api.github.com/users/rom1504/received_events",
                "repos_url": "https://api.github.com/users/rom1504/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/rom1504/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/rom1504/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/rom1504"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2015-07-21T05:05:48Z",
            "event": "labeled",
            "id": 360771795,
            "label": {
                "color": "e10c02",
                "name": "bug"
            },
            "url": "https://api.github.com/repos/PrismarineJS/mineflayer/issues/events/360771795"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1069318?v=3",
                "events_url": "https://api.github.com/users/roblabla/events{/privacy}",
                "followers_url": "https://api.github.com/users/roblabla/followers",
                "following_url": "https://api.github.com/users/roblabla/following{/other_user}",
                "gists_url": "https://api.github.com/users/roblabla/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/roblabla",
                "id": 1069318,
                "login": "roblabla",
                "organizations_url": "https://api.github.com/users/roblabla/orgs",
                "received_events_url": "https://api.github.com/users/roblabla/received_events",
                "repos_url": "https://api.github.com/users/roblabla/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/roblabla/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/roblabla/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/roblabla"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2015-07-22T23:29:57Z",
            "event": "mentioned",
            "id": 362870322,
            "url": "https://api.github.com/repos/PrismarineJS/mineflayer/issues/events/362870322"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1069318?v=3",
                "events_url": "https://api.github.com/users/roblabla/events{/privacy}",
                "followers_url": "https://api.github.com/users/roblabla/followers",
                "following_url": "https://api.github.com/users/roblabla/following{/other_user}",
                "gists_url": "https://api.github.com/users/roblabla/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/roblabla",
                "id": 1069318,
                "login": "roblabla",
                "organizations_url": "https://api.github.com/users/roblabla/orgs",
                "received_events_url": "https://api.github.com/users/roblabla/received_events",
                "repos_url": "https://api.github.com/users/roblabla/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/roblabla/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/roblabla/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/roblabla"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2015-07-22T23:29:57Z",
            "event": "subscribed",
            "id": 362870323,
            "url": "https://api.github.com/repos/PrismarineJS/mineflayer/issues/events/362870323"
        }
    ],
    "events_url": "https://api.github.com/repos/PrismarineJS/mineflayer/issues/304/events",
    "html_url": "https://github.com/PrismarineJS/mineflayer/issues/304",
    "id": 94342072,
    "labels": [
        {
            "color": "5319e7",
            "name": "block",
            "url": "https://api.github.com/repos/PrismarineJS/mineflayer/labels/block"
        },
        {
            "color": "e10c02",
            "name": "bug",
            "url": "https://api.github.com/repos/PrismarineJS/mineflayer/labels/bug"
        }
    ],
    "labels_url": "https://api.github.com/repos/PrismarineJS/mineflayer/issues/304/labels{/name}",
    "locked": false,
    "milestone": null,
    "number": 304,
    "repository_url": "https://api.github.com/repos/PrismarineJS/mineflayer",
    "state": "open",
    "title": "Light updates seem to have no effect",
    "updated_at": "2016-01-07T09:50:41Z",
    "url": "https://api.github.com/repos/PrismarineJS/mineflayer/issues/304",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/5508988?v=3",
        "events_url": "https://api.github.com/users/Darker/events{/privacy}",
        "followers_url": "https://api.github.com/users/Darker/followers",
        "following_url": "https://api.github.com/users/Darker/following{/other_user}",
        "gists_url": "https://api.github.com/users/Darker/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/Darker",
        "id": 5508988,
        "login": "Darker",
        "organizations_url": "https://api.github.com/users/Darker/orgs",
        "received_events_url": "https://api.github.com/users/Darker/received_events",
        "repos_url": "https://api.github.com/users/Darker/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/Darker/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/Darker/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/Darker"
    }
}