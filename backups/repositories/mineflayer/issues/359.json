{
    "assignee": null,
    "body": "mineflayer doesn't appear to handle failures to join a server, for example if the server requires FML/Forge — the server will send a message saying so, but mineflayer silently disconnects with no error:\r\n\r\n```\r\nmineflayer $ NODE_DEBUG=mc-proto node examples/echo.js localhost 25565\r\nMC-PROTO: 82141 writing packet handshaking.set_protocol\r\nMC-PROTO: 82141 { protocolVersion: 47,\r\n  serverHost: 'localhost',\r\n  serverPort: 25565,\r\n  nextState: 2 }\r\nMC-PROTO: 82141 writing packet login.login_start\r\nMC-PROTO: 82141 { username: 'echo' }\r\n```\r\n\r\nTested with [forge-1.8.9-11.15.0.1715](http://files.minecraftforge.net/maven/net/minecraftforge/forge/index_1.8.9.html) + mods/[ironchest-1.8.9-6.0.121.768.jar](http://files.minecraftforge.net/maven/cpw/mods/ironchest/index_1.8.9.html) (you need at least one client/server mod, or Forge will let vanilla clients connect). The official client will display the error message:\r\n\r\n<img width=\"966\" alt=\"screen shot 2016-01-21 at 11 08 46 pm\" src=\"https://cloud.githubusercontent.com/assets/5897956/12504652/69ccc126-c094-11e5-9d87-165f17f7831b.png\">\r\n\r\ncorresponding to the server log:\r\n\r\n[22:57:37] [Netty Server IO #3/INFO] [FML]: Disconnecting Player: This server requires FML/Forge to be installed. Contact your server admin for more details.\r\n\r\nbut mineflayer is silent. Used the echo example, but I suspect this failure case should be handled generically in mineflayer (meaning, not something mineflayer bots need to handle themselves), or possibly in node-minecraft-protocol, but I guess mineflayer is more appropriate though I do not yet know the details of how this message is processed ('client kicked' message? something else?).\r\n\r\nRelevant:\r\n\r\nhttps://github.com/PrismarineJS/mineflayer/issues/56 MC Forge - an old but still interesting future enhancement\r\n\r\nhttps://github.com/PrismarineJS/mineflayer/issues/309 Need better disconnect handling - not seeing this same error though",
    "closed_at": "2016-01-23T21:00:37Z",
    "comment_data": [
        {
            "body": "Looking at a packet capture in Wireshark, after the client sends its username (login_start message), server replies with this packet (presumably not handled by node-minecraft-protocol?):\r\n\r\n```\r\n                        5f00 5d22 5468 6973  \"q.a\"q.`_.]\"This\r\n    2073 6572 7665 7220 7265 7175 6972 6573  .server.requires\r\n    2046 4d4c 2f46 6f72 6765 2074 6f20 6265  .FML/Forge.to.be\r\n    2069 6e73 7461 6c6c 6564 2e20 436f 6e74  .installed..Cont\r\n    6163 7420 796f 7572 2073 6572 7665 7220  act.your.server.\r\n    6164 6d69 6e20 666f 7220 6d6f 7265 2064  admin.for.more.d\r\n    6574 6169 6c73 2e22                      etails.\" \r\n```\r\n\r\nthink it's this packet: http://wiki.vg/Protocol#Disconnect_2",
            "created_at": "2016-01-22T08:24:30Z",
            "html_url": "https://github.com/PrismarineJS/mineflayer/issues/359#issuecomment-173841676",
            "id": 173841676,
            "issue_url": "https://api.github.com/repos/PrismarineJS/mineflayer/issues/359",
            "updated_at": "2016-01-22T08:28:31Z",
            "url": "https://api.github.com/repos/PrismarineJS/mineflayer/issues/comments/173841676",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5897956?v=3",
                "events_url": "https://api.github.com/users/deathcap/events{/privacy}",
                "followers_url": "https://api.github.com/users/deathcap/followers",
                "following_url": "https://api.github.com/users/deathcap/following{/other_user}",
                "gists_url": "https://api.github.com/users/deathcap/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/deathcap",
                "id": 5897956,
                "login": "deathcap",
                "organizations_url": "https://api.github.com/users/deathcap/orgs",
                "received_events_url": "https://api.github.com/users/deathcap/received_events",
                "repos_url": "https://api.github.com/users/deathcap/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/deathcap/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/deathcap/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/deathcap"
            }
        },
        {
            "body": "The 'disconnect' event is emitted when receiving this packet, PR'd to NMP examples in https://github.com/PrismarineJS/node-minecraft-protocol/pull/323 Show disconnect reason in examples — but mineflayer probably should also handle this as well",
            "created_at": "2016-01-22T08:37:29Z",
            "html_url": "https://github.com/PrismarineJS/mineflayer/issues/359#issuecomment-173844814",
            "id": 173844814,
            "issue_url": "https://api.github.com/repos/PrismarineJS/mineflayer/issues/359",
            "updated_at": "2016-01-22T08:37:29Z",
            "url": "https://api.github.com/repos/PrismarineJS/mineflayer/issues/comments/173844814",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5897956?v=3",
                "events_url": "https://api.github.com/users/deathcap/events{/privacy}",
                "followers_url": "https://api.github.com/users/deathcap/followers",
                "following_url": "https://api.github.com/users/deathcap/following{/other_user}",
                "gists_url": "https://api.github.com/users/deathcap/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/deathcap",
                "id": 5897956,
                "login": "deathcap",
                "organizations_url": "https://api.github.com/users/deathcap/orgs",
                "received_events_url": "https://api.github.com/users/deathcap/received_events",
                "repos_url": "https://api.github.com/users/deathcap/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/deathcap/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/deathcap/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/deathcap"
            }
        },
        {
            "body": "yeah I think we should just listen on `'disconnect'` too there https://github.com/PrismarineJS/mineflayer/blob/master/lib/plugins/kick.js",
            "created_at": "2016-01-22T10:16:27Z",
            "html_url": "https://github.com/PrismarineJS/mineflayer/issues/359#issuecomment-173869862",
            "id": 173869862,
            "issue_url": "https://api.github.com/repos/PrismarineJS/mineflayer/issues/359",
            "updated_at": "2016-01-22T10:16:27Z",
            "url": "https://api.github.com/repos/PrismarineJS/mineflayer/issues/comments/173869862",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2346494?v=3",
                "events_url": "https://api.github.com/users/rom1504/events{/privacy}",
                "followers_url": "https://api.github.com/users/rom1504/followers",
                "following_url": "https://api.github.com/users/rom1504/following{/other_user}",
                "gists_url": "https://api.github.com/users/rom1504/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/rom1504",
                "id": 2346494,
                "login": "rom1504",
                "organizations_url": "https://api.github.com/users/rom1504/orgs",
                "received_events_url": "https://api.github.com/users/rom1504/received_events",
                "repos_url": "https://api.github.com/users/rom1504/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/rom1504/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/rom1504/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/rom1504"
            }
        },
        {
            "body": "Tested adding in lib/plugins/kick.js, but the only example that listens for kicked is examples/chatterbox.js, I wonder if it is possible/worthwhile to provide a \"default\" listener for kick/disconnect events? or should all the examples be updated?",
            "created_at": "2016-01-23T04:57:59Z",
            "html_url": "https://github.com/PrismarineJS/mineflayer/issues/359#issuecomment-174141879",
            "id": 174141879,
            "issue_url": "https://api.github.com/repos/PrismarineJS/mineflayer/issues/359",
            "updated_at": "2016-01-23T04:57:59Z",
            "url": "https://api.github.com/repos/PrismarineJS/mineflayer/issues/comments/174141879",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5897956?v=3",
                "events_url": "https://api.github.com/users/deathcap/events{/privacy}",
                "followers_url": "https://api.github.com/users/deathcap/followers",
                "following_url": "https://api.github.com/users/deathcap/following{/other_user}",
                "gists_url": "https://api.github.com/users/deathcap/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/deathcap",
                "id": 5897956,
                "login": "deathcap",
                "organizations_url": "https://api.github.com/users/deathcap/orgs",
                "received_events_url": "https://api.github.com/users/deathcap/received_events",
                "repos_url": "https://api.github.com/users/deathcap/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/deathcap/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/deathcap/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/deathcap"
            }
        },
        {
            "body": "Updating all the examples to listen for the mineflayer `kicked` API event is probably superfluous, chatterbox.js already does it as an example (but idk why NODE_DEBUG=mc-proto does not show the disconnect? would be useful if there was some internal debugging mechanism in NMP to see it at least *update: https://github.com/PrismarineJS/node-minecraft-protocol/pull/325*), pull request to listen for login disconnect kicks (including \"This server requires FML/Forge to be installed\"): https://github.com/PrismarineJS/mineflayer/pull/360",
            "created_at": "2016-01-23T19:27:59Z",
            "html_url": "https://github.com/PrismarineJS/mineflayer/issues/359#issuecomment-174214275",
            "id": 174214275,
            "issue_url": "https://api.github.com/repos/PrismarineJS/mineflayer/issues/359",
            "updated_at": "2016-01-23T22:34:26Z",
            "url": "https://api.github.com/repos/PrismarineJS/mineflayer/issues/comments/174214275",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5897956?v=3",
                "events_url": "https://api.github.com/users/deathcap/events{/privacy}",
                "followers_url": "https://api.github.com/users/deathcap/followers",
                "following_url": "https://api.github.com/users/deathcap/following{/other_user}",
                "gists_url": "https://api.github.com/users/deathcap/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/deathcap",
                "id": 5897956,
                "login": "deathcap",
                "organizations_url": "https://api.github.com/users/deathcap/orgs",
                "received_events_url": "https://api.github.com/users/deathcap/received_events",
                "repos_url": "https://api.github.com/users/deathcap/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/deathcap/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/deathcap/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/deathcap"
            }
        }
    ],
    "comments": 5,
    "comments_url": "https://api.github.com/repos/PrismarineJS/mineflayer/issues/359/comments",
    "created_at": "2016-01-22T07:16:48Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2346494?v=3",
                "events_url": "https://api.github.com/users/rom1504/events{/privacy}",
                "followers_url": "https://api.github.com/users/rom1504/followers",
                "following_url": "https://api.github.com/users/rom1504/following{/other_user}",
                "gists_url": "https://api.github.com/users/rom1504/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/rom1504",
                "id": 2346494,
                "login": "rom1504",
                "organizations_url": "https://api.github.com/users/rom1504/orgs",
                "received_events_url": "https://api.github.com/users/rom1504/received_events",
                "repos_url": "https://api.github.com/users/rom1504/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/rom1504/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/rom1504/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/rom1504"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2016-01-23T21:00:37Z",
            "event": "closed",
            "id": 524009058,
            "url": "https://api.github.com/repos/PrismarineJS/mineflayer/issues/events/524009058"
        }
    ],
    "events_url": "https://api.github.com/repos/PrismarineJS/mineflayer/issues/359/events",
    "html_url": "https://github.com/PrismarineJS/mineflayer/issues/359",
    "id": 128098928,
    "labels": [],
    "labels_url": "https://api.github.com/repos/PrismarineJS/mineflayer/issues/359/labels{/name}",
    "locked": false,
    "milestone": null,
    "number": 359,
    "state": "closed",
    "title": "Missing disconnect kick message (\"This server requires FML/Forge to be installed\")",
    "updated_at": "2016-01-23T22:34:26Z",
    "url": "https://api.github.com/repos/PrismarineJS/mineflayer/issues/359",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/5897956?v=3",
        "events_url": "https://api.github.com/users/deathcap/events{/privacy}",
        "followers_url": "https://api.github.com/users/deathcap/followers",
        "following_url": "https://api.github.com/users/deathcap/following{/other_user}",
        "gists_url": "https://api.github.com/users/deathcap/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/deathcap",
        "id": 5897956,
        "login": "deathcap",
        "organizations_url": "https://api.github.com/users/deathcap/orgs",
        "received_events_url": "https://api.github.com/users/deathcap/received_events",
        "repos_url": "https://api.github.com/users/deathcap/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/deathcap/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/deathcap/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/deathcap"
    }
}