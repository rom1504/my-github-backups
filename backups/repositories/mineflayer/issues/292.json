{
    "assignee": null,
    "body": "Somewhat related to #262 \r\n\r\nI was having some trouble digging blocks on a modded server and it turned out that the server actually checks if the player is looking directly at the block when digging or interacting with blocks and it fails otherwise.\r\n\r\nCalling look() or lookAt() before digging or interacting with a block currently doesn't work in this case, even if we set force to true, because the position update is actually sent up to 50 ms after the call and the server receives the block_dig or block_place packet before it knows we moved.\r\n\r\nThis also affects functions like activateBlock() and it causes problems when opening chests or interacting with some other blocks, it does not happen on a Vanilla server though.\r\n\r\nA simple workaround would be to always wait for the 'move' event before proceeding but I think it's better to send the position update immediately because otherwise the documentation is misleading, it says:\r\n\r\n> force - If present and true, skips the smooth server-side transition. Specify this to true if you need the server to know exactly where you are looking, such as for dropping items or shooting arrows.\r\n\r\nbut even when force is true you currently have to do something like this:\r\n\r\n```javascript\r\nbot.look(yaw, pitch, true)\r\nbot.once('move', function() {\r\n  // drop item, shoot arrow...\r\n})\r\n```\r\n",
    "closed_at": "2015-05-24T21:00:12Z",
    "comment_data": [
        {
            "body": "That means we might send position updates faster than every 50ms. That's probably not a problem though.\r\nAre you sure \"force looking\" is ok though ? look at that line https://github.com/andrewrk/mineflayer/blob/master/lib/plugins/physics.js#L238\r\nIs the vanilla client properly displaying the bot look with this change ?\r\n\r\n> 22:15 <+Thinkofdeath> rom1504: sending it faster will cause a few issues, namely things like health regen\r\n> 22:16 <+ammar2> Thinkofdeath: really? it's not aggregated across multiple movements?\r\n> 22:17 <+Thinkofdeath> nope, movement has been broken for years :P\r\n> 22:17 <+Thinkofdeath> its a hard issue to fix\r\n\r\nSo actually it seems sending faster than every 50ms might cause problem, this means we should probably put the `bot.once('move', function() {` in `bot.look` and add a callback to bot.look and then use that in bot.dig and bot.activateBlock.\r\n\r\nWe could avoid using force with something similar (put a `bot.on('move'` and check for yaw until we are at the proper yaw and then call the callback)",
            "created_at": "2015-05-24T20:18:11Z",
            "html_url": "https://github.com/andrewrk/mineflayer/pull/292#issuecomment-105058804",
            "id": 105058804,
            "issue_url": "https://api.github.com/repos/andrewrk/mineflayer/issues/292",
            "updated_at": "2015-05-24T20:24:48Z",
            "url": "https://api.github.com/repos/andrewrk/mineflayer/issues/comments/105058804",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2346494?v=3",
                "events_url": "https://api.github.com/users/rom1504/events{/privacy}",
                "followers_url": "https://api.github.com/users/rom1504/followers",
                "following_url": "https://api.github.com/users/rom1504/following{/other_user}",
                "gists_url": "https://api.github.com/users/rom1504/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/rom1504",
                "id": 2346494,
                "login": "rom1504",
                "organizations_url": "https://api.github.com/users/rom1504/orgs",
                "received_events_url": "https://api.github.com/users/rom1504/received_events",
                "repos_url": "https://api.github.com/users/rom1504/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/rom1504/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/rom1504/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/rom1504"
            }
        },
        {
            "body": "I did that in a7ba46e7473a73a7dc428476fde6554a8fd754c4 .\r\nThat's a better fix : no force move needed, no sending position faster than every 50ms needed.\r\nThat should fix your pb too on your modded server ;)",
            "created_at": "2015-05-24T21:00:12Z",
            "html_url": "https://github.com/andrewrk/mineflayer/pull/292#issuecomment-105061863",
            "id": 105061863,
            "issue_url": "https://api.github.com/repos/andrewrk/mineflayer/issues/292",
            "updated_at": "2015-05-24T21:00:12Z",
            "url": "https://api.github.com/repos/andrewrk/mineflayer/issues/comments/105061863",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2346494?v=3",
                "events_url": "https://api.github.com/users/rom1504/events{/privacy}",
                "followers_url": "https://api.github.com/users/rom1504/followers",
                "following_url": "https://api.github.com/users/rom1504/following{/other_user}",
                "gists_url": "https://api.github.com/users/rom1504/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/rom1504",
                "id": 2346494,
                "login": "rom1504",
                "organizations_url": "https://api.github.com/users/rom1504/orgs",
                "received_events_url": "https://api.github.com/users/rom1504/received_events",
                "repos_url": "https://api.github.com/users/rom1504/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/rom1504/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/rom1504/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/rom1504"
            }
        },
        {
            "body": "Nice, thanks!",
            "created_at": "2015-05-24T21:42:59Z",
            "html_url": "https://github.com/andrewrk/mineflayer/pull/292#issuecomment-105064103",
            "id": 105064103,
            "issue_url": "https://api.github.com/repos/andrewrk/mineflayer/issues/292",
            "updated_at": "2015-05-24T21:42:59Z",
            "url": "https://api.github.com/repos/andrewrk/mineflayer/issues/comments/105064103",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/748972?v=3",
                "events_url": "https://api.github.com/users/Pietro210/events{/privacy}",
                "followers_url": "https://api.github.com/users/Pietro210/followers",
                "following_url": "https://api.github.com/users/Pietro210/following{/other_user}",
                "gists_url": "https://api.github.com/users/Pietro210/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Pietro210",
                "id": 748972,
                "login": "Pietro210",
                "organizations_url": "https://api.github.com/users/Pietro210/orgs",
                "received_events_url": "https://api.github.com/users/Pietro210/received_events",
                "repos_url": "https://api.github.com/users/Pietro210/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Pietro210/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Pietro210/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Pietro210"
            }
        }
    ],
    "comments": 3,
    "comments_url": "https://api.github.com/repos/andrewrk/mineflayer/issues/292/comments",
    "created_at": "2015-05-24T00:52:04Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/748972?v=3",
                "events_url": "https://api.github.com/users/Pietro210/events{/privacy}",
                "followers_url": "https://api.github.com/users/Pietro210/followers",
                "following_url": "https://api.github.com/users/Pietro210/following{/other_user}",
                "gists_url": "https://api.github.com/users/Pietro210/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Pietro210",
                "id": 748972,
                "login": "Pietro210",
                "organizations_url": "https://api.github.com/users/Pietro210/orgs",
                "received_events_url": "https://api.github.com/users/Pietro210/received_events",
                "repos_url": "https://api.github.com/users/Pietro210/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Pietro210/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Pietro210/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Pietro210"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2015-05-24T05:26:03Z",
            "event": "renamed",
            "id": 312491925,
            "rename": {
                "from": "Send position immediately after look() is called",
                "to": "Look immediately when digging or placing a block"
            },
            "url": "https://api.github.com/repos/andrewrk/mineflayer/issues/events/312491925"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/748972?v=3",
                "events_url": "https://api.github.com/users/Pietro210/events{/privacy}",
                "followers_url": "https://api.github.com/users/Pietro210/followers",
                "following_url": "https://api.github.com/users/Pietro210/following{/other_user}",
                "gists_url": "https://api.github.com/users/Pietro210/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Pietro210",
                "id": 748972,
                "login": "Pietro210",
                "organizations_url": "https://api.github.com/users/Pietro210/orgs",
                "received_events_url": "https://api.github.com/users/Pietro210/received_events",
                "repos_url": "https://api.github.com/users/Pietro210/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Pietro210/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Pietro210/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Pietro210"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2015-05-24T05:27:18Z",
            "event": "renamed",
            "id": 312491998,
            "rename": {
                "from": "Look immediately when digging or placing a block",
                "to": "Look immediately when digging or activating a block"
            },
            "url": "https://api.github.com/repos/andrewrk/mineflayer/issues/events/312491998"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/2346494?v=3",
                "events_url": "https://api.github.com/users/rom1504/events{/privacy}",
                "followers_url": "https://api.github.com/users/rom1504/followers",
                "following_url": "https://api.github.com/users/rom1504/following{/other_user}",
                "gists_url": "https://api.github.com/users/rom1504/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/rom1504",
                "id": 2346494,
                "login": "rom1504",
                "organizations_url": "https://api.github.com/users/rom1504/orgs",
                "received_events_url": "https://api.github.com/users/rom1504/received_events",
                "repos_url": "https://api.github.com/users/rom1504/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/rom1504/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/rom1504/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/rom1504"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2015-05-24T21:00:12Z",
            "event": "closed",
            "id": 312651863,
            "url": "https://api.github.com/repos/andrewrk/mineflayer/issues/events/312651863"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/748972?v=3",
                "events_url": "https://api.github.com/users/Pietro210/events{/privacy}",
                "followers_url": "https://api.github.com/users/Pietro210/followers",
                "following_url": "https://api.github.com/users/Pietro210/following{/other_user}",
                "gists_url": "https://api.github.com/users/Pietro210/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/Pietro210",
                "id": 748972,
                "login": "Pietro210",
                "organizations_url": "https://api.github.com/users/Pietro210/orgs",
                "received_events_url": "https://api.github.com/users/Pietro210/received_events",
                "repos_url": "https://api.github.com/users/Pietro210/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/Pietro210/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/Pietro210/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/Pietro210"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2015-05-24T21:46:49Z",
            "event": "head_ref_deleted",
            "id": 312658673,
            "url": "https://api.github.com/repos/andrewrk/mineflayer/issues/events/312658673"
        }
    ],
    "events_url": "https://api.github.com/repos/andrewrk/mineflayer/issues/292/events",
    "html_url": "https://github.com/andrewrk/mineflayer/pull/292",
    "id": 80002575,
    "labels": [],
    "labels_url": "https://api.github.com/repos/andrewrk/mineflayer/issues/292/labels{/name}",
    "locked": false,
    "milestone": null,
    "number": 292,
    "pull_request": {
        "diff_url": "https://github.com/andrewrk/mineflayer/pull/292.diff",
        "html_url": "https://github.com/andrewrk/mineflayer/pull/292",
        "patch_url": "https://github.com/andrewrk/mineflayer/pull/292.patch",
        "url": "https://api.github.com/repos/andrewrk/mineflayer/pulls/292"
    },
    "state": "closed",
    "title": "Look immediately when digging or activating a block",
    "updated_at": "2015-05-24T21:46:49Z",
    "url": "https://api.github.com/repos/andrewrk/mineflayer/issues/292",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/748972?v=3",
        "events_url": "https://api.github.com/users/Pietro210/events{/privacy}",
        "followers_url": "https://api.github.com/users/Pietro210/followers",
        "following_url": "https://api.github.com/users/Pietro210/following{/other_user}",
        "gists_url": "https://api.github.com/users/Pietro210/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/Pietro210",
        "id": 748972,
        "login": "Pietro210",
        "organizations_url": "https://api.github.com/users/Pietro210/orgs",
        "received_events_url": "https://api.github.com/users/Pietro210/received_events",
        "repos_url": "https://api.github.com/users/Pietro210/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/Pietro210/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/Pietro210/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/Pietro210"
    }
}