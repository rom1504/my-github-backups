{
    "assignee": null,
    "body": "Before the streams refactor, MC packets were sent with the packet length prefix and payload combined in one call. This PR restores this behavior, instead of sending the packet length and payload in two separate `this.push()` calls.\r\n\r\nref: https://github.com/deathcap/wsmc/pull/21#issuecomment-172284334\r\n\r\n(With this change, browserified mineflayer now works with the latest node-minecraft-protocol)",
    "closed_at": null,
    "comment_data": [
        {
            "body": "Marking this as WIP, investigating potentially better solutions.",
            "created_at": "2016-01-17T02:25:43Z",
            "html_url": "https://github.com/PrismarineJS/node-minecraft-protocol/pull/316#issuecomment-172285064",
            "id": 172285064,
            "issue_url": "https://api.github.com/repos/PrismarineJS/node-minecraft-protocol/issues/316",
            "updated_at": "2016-01-17T02:25:43Z",
            "url": "https://api.github.com/repos/PrismarineJS/node-minecraft-protocol/issues/comments/172285064",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5897956?v=3",
                "events_url": "https://api.github.com/users/deathcap/events{/privacy}",
                "followers_url": "https://api.github.com/users/deathcap/followers",
                "following_url": "https://api.github.com/users/deathcap/following{/other_user}",
                "gists_url": "https://api.github.com/users/deathcap/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/deathcap",
                "id": 5897956,
                "login": "deathcap",
                "organizations_url": "https://api.github.com/users/deathcap/orgs",
                "received_events_url": "https://api.github.com/users/deathcap/received_events",
                "repos_url": "https://api.github.com/users/deathcap/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/deathcap/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/deathcap/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/deathcap"
            }
        },
        {
            "body": "I went with disabling MC packet framing instead (not needed when tunneling over websockets since they have their own framing, https://github.com/deathcap/wsmc/pull/21#issuecomment-172285314), works well and requires no changes to this project. \r\n\r\nThere's still the question of whether two push()'s vs one push() has any effect on normal node-minecraft-protocol usage, but I think the TCP stack will coalesce multiple small writes into one larger packet by default, unless `this.socket.setNoDelay` (`TCP_NODELAY`) is set, so packets should not normally be fragmented. This could be tested further, but if they were fragmented (into 1-byte length packet + n-byte payload packets), the other side should still behave correctly, but there could be a performance/latency impact. Relevant:\r\n\r\nhttps://github.com/PrismarineJS/node-minecraft-protocol/blob/master/HISTORY.md#073\r\n\r\n> 0.7.3\r\n> * revert removing socket delays to reduce latency as it was causing errors and test failures.\r\n> * server: Client now emits more predictable 'end' events.\r\n",
            "created_at": "2016-01-17T04:04:53Z",
            "html_url": "https://github.com/PrismarineJS/node-minecraft-protocol/pull/316#issuecomment-172290145",
            "id": 172290145,
            "issue_url": "https://api.github.com/repos/PrismarineJS/node-minecraft-protocol/issues/316",
            "updated_at": "2016-01-17T04:04:53Z",
            "url": "https://api.github.com/repos/PrismarineJS/node-minecraft-protocol/issues/comments/172290145",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5897956?v=3",
                "events_url": "https://api.github.com/users/deathcap/events{/privacy}",
                "followers_url": "https://api.github.com/users/deathcap/followers",
                "following_url": "https://api.github.com/users/deathcap/following{/other_user}",
                "gists_url": "https://api.github.com/users/deathcap/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/deathcap",
                "id": 5897956,
                "login": "deathcap",
                "organizations_url": "https://api.github.com/users/deathcap/orgs",
                "received_events_url": "https://api.github.com/users/deathcap/received_events",
                "repos_url": "https://api.github.com/users/deathcap/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/deathcap/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/deathcap/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/deathcap"
            }
        },
        {
            "body": "Reopening for reconsideration in the normal TCP socket environment (not using WS), per https://github.com/PrismarineJS/node-minecraft-protocol/issues/312#issuecomment-172660685, re: @roblabla \r\n\r\n> we actually send two TCP frames, one with the ID alone, one with the content. I consciously chose this on-the-wire overhead over recreating a buffer for the sole purpose of doing only a single, clean write.\r\n\r\nSurprised to hear this, it is actually faster in practice? I would think the network overhead of two packets would be greater than the memory/cpu overhead of coalescing them into one, but haven't benchmarked it.\r\n\r\nIf the overhead of copying is great, another option might be to cork and uncork the stream — for some reason this wasn't having any effect in my testing with websockets, but it might work with TCP sockets (would need further testing).\r\n\r\n(If there was only one write per MC packet, this also could be another option besides having an option to disable MC packet framing for WS (attempting in https://github.com/PrismarineJS/node-minecraft-protocol/pull/320 but running into some abstraction/layering difficulties - single writes may be more straightforward).)",
            "created_at": "2016-01-18T21:58:41Z",
            "html_url": "https://github.com/PrismarineJS/node-minecraft-protocol/pull/316#issuecomment-172665545",
            "id": 172665545,
            "issue_url": "https://api.github.com/repos/PrismarineJS/node-minecraft-protocol/issues/316",
            "updated_at": "2016-01-18T21:58:41Z",
            "url": "https://api.github.com/repos/PrismarineJS/node-minecraft-protocol/issues/comments/172665545",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5897956?v=3",
                "events_url": "https://api.github.com/users/deathcap/events{/privacy}",
                "followers_url": "https://api.github.com/users/deathcap/followers",
                "following_url": "https://api.github.com/users/deathcap/following{/other_user}",
                "gists_url": "https://api.github.com/users/deathcap/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/deathcap",
                "id": 5897956,
                "login": "deathcap",
                "organizations_url": "https://api.github.com/users/deathcap/orgs",
                "received_events_url": "https://api.github.com/users/deathcap/received_events",
                "repos_url": "https://api.github.com/users/deathcap/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/deathcap/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/deathcap/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/deathcap"
            }
        },
        {
            "body": "Fun Facts : \r\n\r\npacket type | overhead server-client | overhead client-server\r\n------------------|-------------------------------|---------------------------------\r\nEmpty TCP Packet + IP header | 64 | 64  \r\nWS Packet <126 bytes | 6 | 2\r\nWS Packet <64 kb |8 |4\r\nWS Packet <2**63 kb |12 |8\r\n\r\nAnyway, the CPU time overhead is probably negligeable. It'd be nice to benchmark it though.",
            "created_at": "2016-01-20T14:53:58Z",
            "html_url": "https://github.com/PrismarineJS/node-minecraft-protocol/pull/316#issuecomment-173227294",
            "id": 173227294,
            "issue_url": "https://api.github.com/repos/PrismarineJS/node-minecraft-protocol/issues/316",
            "updated_at": "2016-01-20T14:53:58Z",
            "url": "https://api.github.com/repos/PrismarineJS/node-minecraft-protocol/issues/comments/173227294",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1069318?v=3",
                "events_url": "https://api.github.com/users/roblabla/events{/privacy}",
                "followers_url": "https://api.github.com/users/roblabla/followers",
                "following_url": "https://api.github.com/users/roblabla/following{/other_user}",
                "gists_url": "https://api.github.com/users/roblabla/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/roblabla",
                "id": 1069318,
                "login": "roblabla",
                "organizations_url": "https://api.github.com/users/roblabla/orgs",
                "received_events_url": "https://api.github.com/users/roblabla/received_events",
                "repos_url": "https://api.github.com/users/roblabla/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/roblabla/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/roblabla/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/roblabla"
            }
        }
    ],
    "comments": 4,
    "comments_url": "https://api.github.com/repos/PrismarineJS/node-minecraft-protocol/issues/316/comments",
    "created_at": "2016-01-17T02:23:28Z",
    "event_data": [
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5897956?v=3",
                "events_url": "https://api.github.com/users/deathcap/events{/privacy}",
                "followers_url": "https://api.github.com/users/deathcap/followers",
                "following_url": "https://api.github.com/users/deathcap/following{/other_user}",
                "gists_url": "https://api.github.com/users/deathcap/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/deathcap",
                "id": 5897956,
                "login": "deathcap",
                "organizations_url": "https://api.github.com/users/deathcap/orgs",
                "received_events_url": "https://api.github.com/users/deathcap/received_events",
                "repos_url": "https://api.github.com/users/deathcap/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/deathcap/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/deathcap/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/deathcap"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2016-01-17T04:05:00Z",
            "event": "closed",
            "id": 517153594,
            "url": "https://api.github.com/repos/PrismarineJS/node-minecraft-protocol/issues/events/517153594"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1069318?v=3",
                "events_url": "https://api.github.com/users/roblabla/events{/privacy}",
                "followers_url": "https://api.github.com/users/roblabla/followers",
                "following_url": "https://api.github.com/users/roblabla/following{/other_user}",
                "gists_url": "https://api.github.com/users/roblabla/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/roblabla",
                "id": 1069318,
                "login": "roblabla",
                "organizations_url": "https://api.github.com/users/roblabla/orgs",
                "received_events_url": "https://api.github.com/users/roblabla/received_events",
                "repos_url": "https://api.github.com/users/roblabla/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/roblabla/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/roblabla/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/roblabla"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2016-01-18T21:58:41Z",
            "event": "mentioned",
            "id": 518420111,
            "url": "https://api.github.com/repos/PrismarineJS/node-minecraft-protocol/issues/events/518420111"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/1069318?v=3",
                "events_url": "https://api.github.com/users/roblabla/events{/privacy}",
                "followers_url": "https://api.github.com/users/roblabla/followers",
                "following_url": "https://api.github.com/users/roblabla/following{/other_user}",
                "gists_url": "https://api.github.com/users/roblabla/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/roblabla",
                "id": 1069318,
                "login": "roblabla",
                "organizations_url": "https://api.github.com/users/roblabla/orgs",
                "received_events_url": "https://api.github.com/users/roblabla/received_events",
                "repos_url": "https://api.github.com/users/roblabla/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/roblabla/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/roblabla/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/roblabla"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2016-01-18T21:58:41Z",
            "event": "subscribed",
            "id": 518420112,
            "url": "https://api.github.com/repos/PrismarineJS/node-minecraft-protocol/issues/events/518420112"
        },
        {
            "actor": {
                "avatar_url": "https://avatars.githubusercontent.com/u/5897956?v=3",
                "events_url": "https://api.github.com/users/deathcap/events{/privacy}",
                "followers_url": "https://api.github.com/users/deathcap/followers",
                "following_url": "https://api.github.com/users/deathcap/following{/other_user}",
                "gists_url": "https://api.github.com/users/deathcap/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/deathcap",
                "id": 5897956,
                "login": "deathcap",
                "organizations_url": "https://api.github.com/users/deathcap/orgs",
                "received_events_url": "https://api.github.com/users/deathcap/received_events",
                "repos_url": "https://api.github.com/users/deathcap/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/deathcap/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/deathcap/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/deathcap"
            },
            "commit_id": null,
            "commit_url": null,
            "created_at": "2016-01-18T21:58:42Z",
            "event": "reopened",
            "id": 518420113,
            "url": "https://api.github.com/repos/PrismarineJS/node-minecraft-protocol/issues/events/518420113"
        }
    ],
    "events_url": "https://api.github.com/repos/PrismarineJS/node-minecraft-protocol/issues/316/events",
    "html_url": "https://github.com/PrismarineJS/node-minecraft-protocol/pull/316",
    "id": 127069669,
    "labels": [],
    "labels_url": "https://api.github.com/repos/PrismarineJS/node-minecraft-protocol/issues/316/labels{/name}",
    "locked": false,
    "milestone": null,
    "number": 316,
    "pull_request": {
        "diff_url": "https://github.com/PrismarineJS/node-minecraft-protocol/pull/316.diff",
        "html_url": "https://github.com/PrismarineJS/node-minecraft-protocol/pull/316",
        "patch_url": "https://github.com/PrismarineJS/node-minecraft-protocol/pull/316.patch",
        "url": "https://api.github.com/repos/PrismarineJS/node-minecraft-protocol/pulls/316"
    },
    "state": "open",
    "title": "[WIP] Send framed packets in one push()",
    "updated_at": "2016-01-20T14:53:58Z",
    "url": "https://api.github.com/repos/PrismarineJS/node-minecraft-protocol/issues/316",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/5897956?v=3",
        "events_url": "https://api.github.com/users/deathcap/events{/privacy}",
        "followers_url": "https://api.github.com/users/deathcap/followers",
        "following_url": "https://api.github.com/users/deathcap/following{/other_user}",
        "gists_url": "https://api.github.com/users/deathcap/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/deathcap",
        "id": 5897956,
        "login": "deathcap",
        "organizations_url": "https://api.github.com/users/deathcap/orgs",
        "received_events_url": "https://api.github.com/users/deathcap/received_events",
        "repos_url": "https://api.github.com/users/deathcap/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/deathcap/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/deathcap/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/deathcap"
    }
}